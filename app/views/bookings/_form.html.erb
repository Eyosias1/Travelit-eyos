<%= simple_form_for [@flat, @booking], data: { controller: 'flatpickr booking', price_per_night: @flat.price_per_night  } do |f| %>
  <%= f.input :start_date, as: :string, html5: true, input_html: {data: { flatpickr_target: "startDate", booking_target: "startDate", action:"click->flatpickr#associerFlatpickr" }, value: @booking.start_date || Date.today}, label: 'Date d\'arrivée', html: {autocomplete: 'off'} %>
  <%= f.input :end_date, as: :string, html5: true, input_html: {data: { flatpickr_target: "endDate", booking_target: "endDate", action: "change->booking#calculatePrice click->flatpickr#associerFlatpickr" }, id: 'end_time',value: @booking.end_date || Date.today + 1}, label: 'Date de départ', html: {autocomplete: 'off'} %>
  <%= f.button :submit, "Réserver", class: "btn btn-primary btn-block", style: "width:100%;" %>

  <div data-booking-target="infos">
    <div class="d-flex justify-content-between mt-3 px-3 text-gray">
      <div data-booking-target="countofdays">
        </div>
      <div data-booking-target="price">
        </div>
    </div>

    <div class="d-flex justify-content-between mt-2 px-3 text-gray">
      <div>
        Frais de service
      </div>
      <div data-booking-target="service">
      </div>
    </div>

    <div class="d-flex justify-content-between mt-2 pb-3 px-3 border-bottom text-gray">
      <div>
        Taxes
      </div>
      <div> 10 €
      </div>
    </div>

    <div class="d-flex justify-content-between mt-3 pb-3 px-3 border-bottom text-bold">
      <div>
        Total
      </div>
      <div data-booking-target="total">
      </div>
    </div>
  </div>

  <h2>Booking Details</h2>
<p>Status: <%= @booking.status %></p>
<% if @booking.accepted? && @booking.tour.description_document.attached? %>
  <p>Tour Description Document: <%= link_to 'Download', rails_blob_path(@booking.tour.description_document) %></p>
<% end %>

<h2>Chat with Guide</h2>
<% if @booking.accepted? && @booking.guide.present? %>
  <p>Guide: <%= @booking.guide.name %></p>
  <%= form_with(url: chat_path, method: :post, remote: true) do |form| %>
    <%= form.hidden_field :booking_id, value: @booking.id %>
    <div>
      <%= form.text_field :message, placeholder: "Type your message..." %>
    </div>
    <div>
      <%= form.submit "Send" %>
    </div>
  <% end %>
<% else %>
  <p>Chat is not available for this booking.</p>
<% end %>


<% end %>
